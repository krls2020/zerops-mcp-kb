{
  "type": "ruby",
  "category": "runtime",
  "description": "Ruby runtime for Rails and other Ruby applications",
  "versions": [
    { "version": "3.3", "status": "current", "recommended": true },
    { "version": "3.2", "status": "active" },
    { "version": "3.1", "status": "active" },
    { "version": "3.0", "status": "security" }
  ],
  "modes": ["NON_HA"],
  "ports": {
    "range": "1-65535",
    "default": 3000,
    "httpSupport": true,
    "protocols": ["TCP", "UDP"]
  },
  "configuration": {
    "build": {
      "base": ["ruby@3.3", "ruby@3.2", "ruby@3.1", "ruby@3.0"],
      "buildCommands": {
        "description": "Commands to build the application",
        "examples": [
          "gem install bundler",
          "bundle install",
          "bundle exec rake assets:precompile",
          "bundle exec rake db:migrate"
        ]
      },
      "deployFiles": {
        "description": "Files to deploy to runtime",
        "patterns": [".", "app/**", "config/**", "public/**"],
        "destination": "/var/www"
      },
      "addToRunPrepare": {
        "description": "Files needed during runtime preparation",
        "common": ["Gemfile", "Gemfile.lock"]
      },
      "cache": {
        "description": "Directories to cache between builds",
        "paths": ["vendor/bundle", ".bundle"]
      }
    },
    "run": {
      "base": ["ruby@3.3", "ruby@3.2", "ruby@3.1", "ruby@3.0"],
      "prepareCommands": {
        "description": "Commands to prepare runtime environment",
        "examples": [
          "bundle install --deployment",
          "bundle exec rake db:migrate",
          "bundle exec rake assets:clean"
        ]
      },
      "start": {
        "description": "Command to start the application",
        "examples": [
          "bundle exec rails server -b 0.0.0.0",
          "bundle exec puma -C config/puma.rb",
          "bundle exec rackup config.ru -p $PORT -o 0.0.0.0"
        ]
      }
    }
  },
  "envVariables": {
    "system": {
      "RAILS_ENV": "production",
      "RACK_ENV": "production",
      "PORT": "${port}",
      "HOSTNAME": "${hostname}"
    },
    "autoGenerated": {
      "hostname": "Service hostname",
      "port": "First exposed port"
    }
  },
  "bestPractices": [
    "Use specific Ruby version",
    "Include Gemfile.lock for reproducible builds",
    "Use bundle install --deployment in production",
    "Precompile assets during build",
    "Configure proper database pool size",
    "Use environment variables for secrets",
    "Enable production optimizations"
  ],
  "commonPatterns": {
    "rails": {
      "buildCommands": [
        "bundle install",
        "bundle exec rake assets:precompile",
        "bundle exec rake db:migrate"
      ],
      "start": "bundle exec rails server -b 0.0.0.0",
      "port": 3000,
      "envVariables": {
        "RAILS_ENV": "production",
        "RAILS_LOG_TO_STDOUT": "true",
        "RAILS_SERVE_STATIC_FILES": "true"
      }
    },
    "sinatra": {
      "start": "bundle exec ruby app.rb",
      "port": 4567
    },
    "hanami": {
      "start": "bundle exec hanami server --host 0.0.0.0",
      "port": 2300
    }
  },
  "examples": {
    "rails": {
      "yamlImport": {
        "services": [
          {
            "hostname": "app",
            "type": "ruby@3.3",
            "ports": [{ "port": 3000, "httpSupport": true }],
            "minContainers": 1,
            "maxContainers": 3,
            "envVariables": {
              "DATABASE_URL": "postgresql://${db_user}:${db_password}@${db_hostname}:5432/${db_dbName}",
              "REDIS_URL": "redis://:${cache_password}@${cache_hostname}:6379",
              "SECRET_KEY_BASE": "your-secret-key-base"
            }
          }
        ]
      },
      "zeropsYml": {
        "zerops": [
          {
            "setup": "app",
            "build": {
              "base": "ruby@3.3",
              "buildCommands": [
                "gem install bundler",
                "bundle install",
                "bundle exec rake assets:precompile"
              ],
              "deployFiles": ".",
              "addToRunPrepare": ["Gemfile", "Gemfile.lock"],
              "cache": ["vendor/bundle"]
            },
            "run": {
              "base": "ruby@3.3",
              "ports": [{ "port": 3000, "httpSupport": true }],
              "prepareCommands": [
                "bundle install --deployment",
                "bundle exec rake db:migrate"
              ],
              "start": "bundle exec rails server -b 0.0.0.0"
            }
          }
        ]
      }
    }
  }
}